<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>BILL | Saravana Bhavan</title>

<link rel="stylesheet"
 href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

<link rel="stylesheet"
 href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

<style>

body{
    background:#eef2ff;
}

/* TOP NAV */
.navbar{
    background:#0f172a;
    box-shadow:0 10px 35px rgba(0,0,0,.45);
}
.page-title{
    font-weight:800;
    color:white;
    letter-spacing:.5px;
}

/* CARDS */
.card-box{
    background:white;
    border-radius:18px;
    padding:22px;
    box-shadow:0 12px 35px rgba(0,0,0,.12);
}

/* TITLES */
.section-title{
    font-weight:900;
    color:#0f172a;
    letter-spacing:.3px;
}

/* TABLE */
thead{
    background:#0ea5e9;
    color:white;
}
tbody tr:hover{
    background:#f0f9ff !important;
}

/* IMAGE */
.food-img{
    width:85px;
    height:85px;
    border-radius:14px;
    object-fit:cover;
}

/* INPUT */
input{
    background:#f3f4f6;
}

/* BUTTON */
.btn-accent{
    background:#0ea5e9;
    color:white;
    border:none;
    font-weight:800;
    border-radius:12px;
}
.btn-accent:hover{
    background:#38bdf8;
    transform:translateY(-1px);
}

footer{
    margin-top:40px;
    height:55px;
    background:#020617;
    color:white;
    text-align:center;
    line-height:55px;
    font-weight:700;
}

.table-dark{
    background:#0f172a !important;
}

.badge-tag{
    background:#cffafe;
    color:#0f172a;
    padding:5px 10px;
    border-radius:10px;
    font-weight:700;
}

</style>
</head>

<body>

<nav class="navbar d-flex justify-content-between px-5 py-3">
    <h2 class="page-title">Bill Management</h2>

    <a href="/customer_dash" class="btn btn-light fw-bold">
        <i class="bi bi-arrow-left"></i> Back
    </a>
</nav>

<div class="container mt-4">

<div th:if="${res}" class="alert alert-info text-center fw-bold shadow">
    <span th:text="${res}"></span>
</div>

<div class="row mt-3">

<!-- ================= LEFT ================= -->
<div class="col-md-5">
<div class="card-box">

<h4 class="section-title">
    Food List <span class="badge-tag">Available</span>
</h4>

<div class="table-responsive mt-3">
<table class="table table-bordered text-center align-middle">

<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th>Price</th>
<th>Stock</th>
<th>Image</th>
<th></th>
</tr>
</thead>

<tbody>
<tr th:each="f : ${food_all1}">
<td th:text="${f.food_id}"></td>
<td th:text="${f.food_name}"></td>
<td>â‚¹ <span th:text="${f.food_price}"></span></td>
<td th:text="${f.food_stock}"></td>

<td>
<img th:if ="${f.food_image != null}"
     th:src="@{'/uploads/food/' + ${f.food_image}}"
     class="food-img">
<span th:if ="${f.food_image == null}" style="color:gray">
No Image
</span>
</td>

<td>
<button class="btn btn-sm btn-accent"
 th:attr="data-id=${f.food_id},
          data-name=${f.food_name},
          data-price=${f.food_price}"
 onclick="selectFood(this)">
 Select
</button>
</td>

</tr>
</tbody>

</table>
</div>

</div>
</div>


<!-- ================= RIGHT ================= -->
<div class="col-md-7">
<div class="card-box">

<h4 class="section-title">Customer Details</h4>

<form th:object="${dto}" method="post" action="/save_bill" class="mt-2">

<div class="mb-2">
<label class="fw-bold">Customer ID</label>
<input type="text" class="form-control" th:field="*{cus_id}">
</div>

<div class="mb-2">
<label class="fw-bold">Customer Name</label>
<input type="text" class="form-control" th:field="*{cus_name}">
</div>

<div class="mb-2">
<label class="fw-bold">Phone</label>
<input type="text" class="form-control" th:field="*{cus_cell}">
</div>

<button class="btn btn-accent w-100">
Save & Continue
</button>

</form>

<hr>

<!-- ================= FOOD SELECT ================= -->
<h4 class="section-title">Select Food</h4>

<form class="mt-2" method="post" action="/bill_insert">

<input type="hidden" name="cus_id"
       th:value="${session.customer != null} ? ${session.customer.cus_id} : ''">

<div class="row">
<div class="col-md-6 mb-2">
<label class="fw-bold">Food ID</label>
<input id="food_id" name="food_id" class="form-control" readonly>
</div>

<div class="col-md-6 mb-2">
<label class="fw-bold">Food</label>
<input id="food_name" name="food_name" class="form-control" readonly>
</div>
</div>

<div class="row">
<div class="col-md-6 mb-2">
<label class="fw-bold">Price</label>
<input id="food_price" name="food_price" class="form-control" readonly>
</div>

<div class="col-md-6 mb-2">
<label class="fw-bold">Quantity</label>
<input type="number" id="food_quantity" name="food_qty"
       class="form-control" min="1">
</div>
</div>

<div class="mb-2">
<label class="fw-bold">Total</label>
<input id="food_total" name="food_total"
       class="form-control" readonly>
</div>

<button class="btn btn-accent w-100">
Add to Cart
</button>

</form>

<hr>

<h4 class="section-title">ðŸ›’ Cart Items</h4>

<div class="table-responsive mt-2">
<table class="table table-bordered text-center align-middle">
<thead class="table-dark">
<tr>
<th>S.No</th>
<th>Food</th>
<th>Price</th>
<th>Qty</th>
<th>Total</th>
<th></th>
</tr>
</thead>

<tbody>

<tr th:each="c, stat : ${cart}">
<td th:text="${stat.count}"></td>
<td th:text="${c.food_name}"></td>
<td th:text="${c.food_price}"></td>
<td th:text="${c.food_qty}"></td>
<td th:text="${c.food_total}"></td>

<td>
<a th:href="@{'/cart_delete?index=' + ${stat.index}}"
   class="btn btn-danger btn-sm">
Delete
</a>
</td>
</tr>

<tr th:if="${#lists.isEmpty(cart)}">
<td colspan="6" class="fw-bold text-danger">
No items added yet
</td>
</tr>

</tbody>
</table>
</div>


<div class="mb-2">
<label class="fw-bold">Grand Total</label>
<input id="grand_total" class="form-control"
       th:value="${grand_total}" readonly>
</div>

<form action="/generate_bill" method="post">
<button class="btn btn-primary w-100">
Generate Bill
</button>
</form>

</div>
</div>

</div>
</div>


<footer>
Â© 2025 Saravana FOOD | Designed Smart ðŸ˜Ž
</footer>


<script>
function selectFood(btn){
 document.getElementById("food_id").value = btn.getAttribute("data-id");
 document.getElementById("food_name").value = btn.getAttribute("data-name");
 document.getElementById("food_price").value = btn.getAttribute("data-price");
 document.getElementById("food_quantity").value = "";
 document.getElementById("food_total").value = "";
}

const qty = document.getElementById("food_quantity");
const price = document.getElementById("food_price");
const total = document.getElementById("food_total");

function calculateTotal(){
 const p = parseFloat(price.value) || 0;
 const q = parseInt(qty.value) || 0;
 total.value = p * q;
}
qty.addEventListener("input", calculateTotal);
</script>

</body>
</html>
