<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>BILL | Saravana Bhavan</title>

<link rel="stylesheet"
 href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

<link rel="stylesheet"
 href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

<style>

body{ background:#e7eff6; }

/* Top Bar */
.navbar{ background:#0f172a; box-shadow:0 8px 25px rgba(0,0,0,.4); }
.page-title{ color:white; font-weight:800; }

/* Card */
.card-box{
    background:white;
    border-radius:18px;
    padding:20px;
    box-shadow:0 10px 30px rgba(0,0,0,.12);
}

/* Section Title */
.section-title{
    font-weight:800;
    color:#0f172a;
}

/* Table */
thead{ background:#14b8a6; color:white; }
tr:hover{ background:#eef9ff !important; }

/* Image */
.food-img{
    width:90px;
    height:90px;
    border-radius:10px;
    object-fit:cover;
}

/* Input */
input{ background:#f3f4f6; }

/* Button */
.btn-accent{
    background:#14b8a6;
    color:#073a35;
    border:none;
    font-weight:700;
}
.btn-accent:hover{ background:#22d3b9; }

footer{
    margin-top:40px;
    height:55px;
    text-align:center;
    background:#0f172a;
    color:white;
    font-weight:bold;
    line-height:55px;
}
</style>
</head>

<body>

<nav class="navbar d-flex justify-content-between px-5 py-3">
    <h2 class="page-title">Bill Management</h2>
    <a href="/customer_dash" class="btn btn-light btn-sm fw-bold">
        <i class="bi bi-arrow-left"></i> Back
    </a>
</nav>

<div class="container mt-4">

<div th:if="${res}" class="alert alert-info text-center fw-bold shadow">
 <span th:text="${res}"></span>
</div>

<div class="row mt-4">

<!-- LEFT SIDE -->
<div class="col-md-5">
<div class="card-box">

<h4 class="section-title">Food List</h4>

<div class="table-responsive mt-3">
<table class="table table-bordered text-center align-middle">

<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th>Price</th>
<th>Stock</th>
<th>Image</th>
<th></th>
</tr>
</thead>

<tbody>
<tr th:each="f : ${food_all1}">
<td th:text="${f.food_id}"></td>
<td th:text="${f.food_name}"></td>
<td>â‚¹ <span th:text="${f.food_price}"></span></td>
<td th:text="${f.food_stock}"></td>

<td>
<img th:if ="${f.food_image != null}"
     th:src="@{'/uploads/food/' + ${f.food_image}}"
     class="food-img">
<span th:if ="${f.food_image == null}" style="color:gray">No Image</span>
</td>

<td>
<button 
 class="btn btn-sm btn-accent"
 th:attr="data-id=${f.food_id},data-name=${f.food_name},data-price=${f.food_price}"
 onclick="selectFood(this)">
 Select
</button>
</td>
</tr>
</tbody>

</table>
</div>
</div>
</div>


<!-- RIGHT SIDE -->
<div class="col-md-7">
<div class="card-box">

<!-- CUSTOMER -->
<h4 class="section-title">Customer Details</h4>

<form th:object="${dto}" method="post" action="/save_bill" class="mt-3">

<div class="mb-3">
<label class="fw-bold">Customer ID</label>
<input type="text" class="form-control" th:field="*{cus_id}">
</div>

<div class="mb-3">
<label class="fw-bold">Customer Name</label>
<input type="text" class="form-control" th:field="*{cus_name}">
</div>

<div class="mb-3">
<label class="fw-bold">Phone</label>
<input type="text" class="form-control" th:field="*{cus_cell}">
</div>

<button class="btn btn-accent w-100">Save & Continue</button>

</form>

<hr>

<form class="mt-3" method="post" action="/bill_insert">

    <!-- CUSTOMER ID (VERY IMPORTANT) -->
    <input type="hidden" name="cus_id" th:value="*{cus_id}">

    <div class="mb-3">
        <label class="fw-bold">Food ID</label>
        <input type="text" id="food_id" name="food_id" class="form-control" readonly>
    </div>

    <div class="mb-3">
        <label class="fw-bold">Food Name</label>
        <input type="text" id="food_name" name="food_name" class="form-control" readonly>
    </div>

    <div class="mb-3">
        <label class="fw-bold">Food Price</label>
        <input type="text" id="food_price" name="food_price" class="form-control" readonly>
    </div>

    <div class="mb-3">
        <label class="fw-bold">Quantity</label>
        <input type="number" id="food_quantity" name="food_qty" class="form-control" min="1">
    </div>

    <div class="mb-3">
        <label class="fw-bold">Total</label>
        <input type="text" id="food_total" name="food_total" class="form-control" readonly>
    </div>

    <!-- SUBMIT BUTTON -->
    <button type="submit" class="btn btn-accent w-100">
        Add to Cart
    </button>

</form>




<h4 class="section-title mt-4">ðŸ›’ Cart Items</h4>

<div class="table-responsive mt-3">
<table class="table table-bordered text-center align-middle">
<thead class="table-dark">
<tr>
    <th>S.No</th>
    <th>Food</th>
    <th>Price</th>
    <th>Qty</th>
    <th>Total</th>
</tr>
</thead>

<tbody>

<tr th:each="c, stat : ${cart}">
    <td th:text="${stat.count}"></td>
    <td th:text="${c.food_name}"></td>
    <td th:text="${c.food_price}"></td>
    <td th:text="${c.food_qty}"></td>
    <td th:text="${c.food_total}"></td>
	
	<td>
	    <a th:href="@{'/cart_delete?index=' + ${stat.index}}"
	       class="btn btn-danger btn-sm"
	       onclick="return confirm('Delete this item?')">
	        Delete
	    </a>
	</td>

</tr>

<tr th:if="${#lists.isEmpty(cart)}">
    <td colspan="5" class="fw-bold text-danger">
        No items added yet
    </td>
</tr>

</tbody>
</table>
</div>


<hr>

<!-- PURCHASED TABLE -->
<h4 class="section-title">Food Purchased</h4>

<div class="table-responsive mt-3">
<table class="table table-bordered text-center align-middle">

<thead>
<tr>
<th>SI No</th>
<th>Name</th>
<th>Price</th>
<th>Quantity</th>
<th>Total</th>
<th>Action</th>
</tr>
</thead>

<tbody>
<tr th:each="b,st : ${bill_items}">
<td th:text="${st.index + 1}"></td>
<td th:text="${b.food_name}"></td>
<td th:text="${b.food_price}"></td>
<td th:text="${b.food_quantity}"></td>
<td th:text="${b.food_total}"></td>

<td>
<button class="btn btn-danger btn-sm">Delete</button>
</td>
</tr>
</tbody>

</table>
</div>

<div class="mb-3">
<label class="fw-bold">Grand Total</label>
<input type="text" id="grand_total" class="form-control"
       th:value = "${grand_total}" readonly>
</div>

<form action="/generate_bill" method="post">
    <button class="btn btn-primary w-100">
        Generate Bill
    </button>
</form>

</div>
</div>

</div>
</div>


<footer>
&copy; 2025 Saravana FOOD | Designed by You
</footer>


<script>
function selectFood(btn){
 document.getElementById("food_id").value = btn.getAttribute("data-id");
 document.getElementById("food_name").value = btn.getAttribute("data-name");
 document.getElementById("food_price").value = btn.getAttribute("data-price");
 document.getElementById("food_quantity").value = "";
 document.getElementById("food_total").value = "";
}

const qty = document.getElementById("food_quantity");
const price = document.getElementById("food_price");
const total = document.getElementById("food_total");

function calculateTotal(){
 const p = parseFloat(price.value) || 0;
 const q = parseInt(qty.value) || 0;
 total.value = p * q;
}
qty.addEventListener("input", calculateTotal);
</script>

</body>
</html>
